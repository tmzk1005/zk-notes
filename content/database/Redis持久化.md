---
title: "Redis持久化"
date: 2021-04-05T11:27:39+08:00
draft: false
tags: ["redis"]
toc: false
---

Redis是一个用c语言开发的Kye-Value数据库，最主要的使用场景就是用作缓存，也经常用来做分布式锁或者消息队列。

Redis常用来和Memcached做比较，两者有一些共同点，也有一些区别：

共同点：

1. 都是基于内存的高性能Key-Value数据库
2. 都有过期策略

区别点：

最显著的区别点就是Redis**支持数据的持久化**，而Memcached不支持，另外Redis支持更加丰富的数据类型，也就支持更加复杂的业务场景。

Redis支持2种不同的持久化策略：

1. RDB

    RDB的思想是保存某一个时刻的数据快照

2. AOF

    AOF的思想是将Redis服务执行过的没一条命令都保存到一个文件，这样当Redis重启时只要按照顺序回放这些命令就可以恢复Redis的状态。

Redis官方推荐的是RDB和AOF这2种持久化方式**同时开启**，为什么呢？

RDB保存的是某一个时刻的快照，如果Redis出现故障，那么从上次保存快照的时刻到当前时间之间的数据就会丢失，如果Redis的QPS比较高，时间也比较长，那么会丢失大量的数据。而AOF保存的是每条命令，因此理论上可以做到在发生故障是只丢失一条命令。

虽然AOF的数据安全性更高，但是AOF方式化的命令恢复时需要重放命令，相比RDB恢复数据时只需要读取二进制数据结构转化为内存中的数据结构而言，性能要差上许多，积累的命令足够多的后，会显著的拖慢Redis的启动速度。

**因为AOF和RDB各有优缺点，Redis一般会同时开启AOF和RDB。**